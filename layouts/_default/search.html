{{ define "main" }}
<div class="content-section">
    <h2>æœç´¢å­¦ä¹ èµ„æ–™</h2>

    <!-- æ·»åŠ åŠ è½½æç¤º -->
    <div class="search-notice">
        <p>ğŸ” æœç´¢å¯èƒ½åŠ è½½è¾ƒæ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚å¦‚æœé•¿æ—¶é—´æ²¡æœ‰ç»“æœï¼Œå¯èƒ½æ˜¯å°šæœªä¸Šä¼ ç›¸å…³èµ„æºã€‚</p>
    </div>

    <div id="search-box"></div>
    
    <!-- æ·»åŠ åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div id="search-loading" style="display: none; text-align: center; padding: 20px;">
        <div style="display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <p style="margin-top: 10px; color: #6c757d;">æœç´¢ä¸­ï¼Œè¯·ç¨å€™...</p>
    </div>
    
    <div id="hits"></div>
    
    <!-- æ·»åŠ åˆ†é¡µæ§ä»¶ -->
    <div id="pagination"></div>

    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.css@8/themes/satellite-min.css">

    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* åˆ†é¡µæ ·å¼ */
        .ais-Pagination {
            margin-top: 30px;
            text-align: center;
        }
        
        .ais-Pagination-list {
            display: inline-flex;
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .ais-Pagination-item {
            margin: 0 5px;
        }
        
        .ais-Pagination-link {
            display: inline-block;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-decoration: none;
            color: #007bff;
        }
        
        .ais-Pagination-link:hover {
            background-color: #f8f9fa;
        }
        
        .ais-Pagination-item--selected .ais-Pagination-link {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .ais-Pagination-item--disabled .ais-Pagination-link {
            color: #6c757d;
            pointer-events: none;
        }
    </style>

    <script>
      // ç¡®ä¿è¿™é‡Œä½¿ç”¨çš„æ˜¯æ­£ç¡®çš„Algoliaå¯†é’¥
      const searchClient = algoliasearch(
        'SMA85IWFQN',
        '8a00c461ba4a78c16cb8862108e7e83a'
      );

      const search = instantsearch({
        indexName: 'nuaaguide',
        searchClient,
        // é…ç½®æœç´¢å‚æ•°
        configure: {
          hitsPerPage: 50 // å¢åŠ æ¯é¡µæ˜¾ç¤ºç»“æœæ•°é‡
        }
      });

      // æ·»åŠ æœç´¢çŠ¶æ€ç›‘å¬
      search.on('render', function() {
        document.getElementById('search-loading').style.display = 'none';
      });
      
      search.on('search', function() {
        document.getElementById('search-loading').style.display = 'block';
      });

      search.addWidgets([
        instantsearch.widgets.searchBox({
          container: '#search-box',
          placeholder: 'è¾“å…¥è¯¾ç¨‹åã€è€å¸ˆæˆ–å…³é”®è¯æœç´¢...',
        }),

        instantsearch.widgets.hits({
          container: '#hits',
          templates: {
            item: `
              <article class="search-result">
                <a href="{{permalink}}" style="color: #0056b3; font-weight: bold;">
                  <h4>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</h4>
                </a>
                <p style="color: #6c757d; margin-top: 4px;">{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p>
                {{#file_url}}<small>ä¸‹è½½èµ„æº</small>{{/file_url}}
              </article>
            `,
            empty: `æ²¡æœ‰æ‰¾åˆ°ä¸ "{{query}}" ç›¸å…³çš„èµ„æ–™ã€‚`,
          },
        }),
        
        // æ·»åŠ åˆ†é¡µæ§ä»¶
        instantsearch.widgets.pagination({
          container: '#pagination',
          padding: 2, // æ˜¾ç¤ºå½“å‰é¡µç å‰åçš„é¡µç æ•°é‡
          showFirst: false, // ä¸æ˜¾ç¤º"ç¬¬ä¸€é¡µ"æŒ‰é’®
          showLast: false, // ä¸æ˜¾ç¤º"æœ€åä¸€é¡µ"æŒ‰é’®
        })
      ]);

      search.start();
    </script>
</div>
{{ end }}
